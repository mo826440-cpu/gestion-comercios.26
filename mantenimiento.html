<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Panel de Mantenimiento - AdminisGo">
    <title>Mantenimiento - AdminisGo</title>
    
    <!-- Estilos -->
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/mantenimiento.css">
    
    <!-- Script inline para aplicar tema antes del renderizado (evita FOUC) -->
    <script>
    (function(){'use strict';try{const t=localStorage.getItem('adminisgo_tema_cache');let e='system';if(t)e=t;else{const n=window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;e=n?'dark':'light'}const n=document.documentElement;n.removeAttribute('data-theme');if(e==='dark'||e==='oscuro')n.setAttribute('data-theme','dark');else if(e==='light'||e==='claro')n.setAttribute('data-theme','light');else{const t=window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;n.setAttribute('data-theme',t?'dark':'light')}}catch(t){const e=window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;document.documentElement.setAttribute('data-theme',e?'dark':'light')}})();
    </script>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîß</text></svg>">
</head>
<body>
    <!-- ============================================
         PANTALLA DE MANTENIMIENTO
         Panel t√©cnico exclusivo para rol "programador"
         
         SEGURIDAD:
         - Solo accesible con rol === "programador"
         - Usuario programador NO se puede crear desde la app
         - Solo existe si fue creado manualmente en Supabase
         - NO se sincroniza con IndexedDB
    ============================================ -->
    
    <!-- Header -->
    <header class="header-mant">
        <div class="contenedor header-contenido">
            <div class="header-izq">
                <span class="header-icono">üîß</span>
                <div class="header-titulo">
                    <h1>Panel de Mantenimiento</h1>
                    <span class="header-badge">SOLO PROGRAMADOR</span>
                </div>
            </div>
            <div class="header-der">
                <span class="usuario-rol" id="usuarioInfo">Cargando...</span>
                <a href="inicio.html" class="btn-volver">‚Üê Volver al Inicio</a>
            </div>
        </div>
    </header>
    
    <!-- Contenido principal -->
    <main class="main-mant">
        <div class="contenedor">
            
            <!-- ============================================
                 AVISO IMPORTANTE - DATOS DEL PROGRAMADOR
            ============================================ -->
            <section class="mant-aviso mant-aviso-seguridad" id="avisoProgramador">
                <div class="aviso-icono">üîí</div>
                <div class="aviso-contenido">
                    <h3>Informaci√≥n de Seguridad</h3>
                    <p>
                        <strong>Los datos del usuario "programador" NO se sincronizan con IndexedDB.</strong>
                        Esto es intencional por seguridad:
                    </p>
                    <ul>
                        <li>‚úì El rol <code>programador</code> solo existe en Supabase</li>
                        <li>‚úì No se puede crear desde la aplicaci√≥n</li>
                        <li>‚úì No se replica a bases de datos locales</li>
                        <li>‚úì Acceso exclusivo al panel de mantenimiento</li>
                    </ul>
                    <p class="aviso-nota">
                        üí° Por esta raz√≥n, siempre habr√° diferencia entre los registros de Supabase e IndexedDB.
                    </p>
                </div>
            </section>
            
            <!-- ============================================
                 SECCI√ìN 1: ESTADO DE MEMORIA
            ============================================ -->
            <section class="mant-seccion" id="seccionMemoria">
                <div class="seccion-header">
                    <h2 class="seccion-titulo">
                        <span class="seccion-icono">üíæ</span>
                        Estado de Memoria
                    </h2>
                    <button class="btn-actualizar" id="btnActualizarMemoria" title="Actualizar">
                        üîÑ Actualizar
                    </button>
                </div>
                
                <div class="seccion-contenido">
                    <div class="memoria-grid">
                        <!-- Memoria Supabase -->
                        <div class="memoria-card">
                            <h3>‚òÅÔ∏è Supabase (Remoto)</h3>
                            <div class="memoria-dato" id="memoriaSupabase">
                                <span class="memoria-valor">--</span>
                                <span class="memoria-label">registros totales</span>
                            </div>
                            <div class="memoria-detalle" id="memoriaSupabaseDetalle">
                                Cargando...
                            </div>
                        </div>
                        
                        <!-- Memoria IndexedDB -->
                        <div class="memoria-card">
                            <h3>üì± IndexedDB (Local)</h3>
                            <div class="memoria-dato" id="memoriaIndexedDB">
                                <span class="memoria-valor">--</span>
                                <span class="memoria-label">registros locales</span>
                            </div>
                            <div class="memoria-detalle" id="memoriaIndexedDBDetalle">
                                Cargando...
                            </div>
                        </div>
                        
                        <!-- Memoria por comercio -->
                        <div class="memoria-card memoria-card-wide">
                            <h3>üè™ Uso por Comercio (Supabase)</h3>
                            <div class="tabla-container" id="memoriaPorComercio">
                                <p class="cargando">Cargando datos...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- ============================================
                 SECCI√ìN 2: ESTAD√çSTICAS DE USO
            ============================================ -->
            <section class="mant-seccion" id="seccionEstadisticas">
                <div class="seccion-header">
                    <h2 class="seccion-titulo">
                        <span class="seccion-icono">üìà</span>
                        Estad√≠sticas del Sistema
                    </h2>
                    <button class="btn-actualizar" id="btnActualizarEstadisticas" title="Actualizar">
                        üîÑ Actualizar
                    </button>
                </div>
                
                <div class="seccion-contenido">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <span class="stat-icono">üè™</span>
                            <span class="stat-valor" id="totalComercios">--</span>
                            <span class="stat-label">Comercios</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-icono">üë•</span>
                            <span class="stat-valor" id="totalUsuarios">--</span>
                            <span class="stat-label">Usuarios</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-icono">üì¶</span>
                            <span class="stat-valor" id="totalProductos">--</span>
                            <span class="stat-label">Productos</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-icono">üõí</span>
                            <span class="stat-valor" id="totalVentas">--</span>
                            <span class="stat-label">Ventas</span>
                        </div>
                    </div>
                    
                    <!-- Detalle por comercio -->
                    <div class="detalle-comercios">
                        <h3>Detalle por Comercio</h3>
                        <div class="tabla-container" id="detalleComerciosTabla">
                            <p class="cargando">Cargando datos...</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- ============================================
                 SECCI√ìN 3: ESTRUCTURA DE BASES DE DATOS
            ============================================ -->
            <section class="mant-seccion" id="seccionEstructura">
                <div class="seccion-header">
                    <h2 class="seccion-titulo">
                        <span class="seccion-icono">üóÑÔ∏è</span>
                        Estructura de Bases de Datos
                    </h2>
                    <button class="btn-actualizar" id="btnActualizarEstructura" title="Actualizar">
                        üîÑ Actualizar
                    </button>
                </div>
                
                <div class="seccion-contenido">
                    <div class="db-grid">
                        <!-- Supabase -->
                        <div class="db-card">
                            <h3>‚òÅÔ∏è Supabase (PostgreSQL)</h3>
                            <div class="db-info">
                                <span class="db-total" id="supabaseTotalTablas">-- tablas</span>
                            </div>
                            <div class="tabla-container tabla-scroll" id="supabaseEstructura">
                                <p class="cargando">Cargando estructura...</p>
                            </div>
                        </div>
                        
                        <!-- IndexedDB -->
                        <div class="db-card">
                            <h3>üì± IndexedDB (Dexie)</h3>
                            <div class="db-info">
                                <span class="db-total" id="indexedDBTotalStores">-- object stores</span>
                            </div>
                            <div class="tabla-container tabla-scroll" id="indexedDBEstructura">
                                <p class="cargando">Cargando estructura...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- ============================================
                 SECCI√ìN 4: SINCRONIZACI√ìN MANUAL
            ============================================ -->
            <section class="mant-seccion" id="seccionSync">
                <div class="seccion-header">
                    <h2 class="seccion-titulo">
                        <span class="seccion-icono">üîÑ</span>
                        Sincronizaci√≥n Manual
                    </h2>
                </div>
                
                <div class="seccion-contenido">
                    <div class="sync-panel">
                        <div class="sync-info">
                            <p>Forzar sincronizaci√≥n completa entre Supabase e IndexedDB.</p>
                            <p class="sync-advertencia">‚ö†Ô∏è Esta operaci√≥n puede tardar dependiendo de la cantidad de datos.</p>
                        </div>
                        
                        <div class="sync-estado" id="syncEstado">
                            <span class="sync-icono">‚è∏Ô∏è</span>
                            <span class="sync-texto">Listo para sincronizar</span>
                        </div>
                        
                        <button class="btn-sync" id="btnForzarSync">
                            üîÑ Forzar Sincronizaci√≥n Supabase ‚áÑ IndexedDB
                        </button>
                        
                        <div class="sync-log" id="syncLog">
                            <!-- Log de sincronizaci√≥n -->
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- ============================================
                 SECCI√ìN 5: MANTENIMIENTO DE DATOS LOCALES
            ============================================ -->
            <section class="mant-seccion" id="seccionDatosLocales">
                <div class="seccion-header">
                    <h2 class="seccion-titulo">
                        <span class="seccion-icono">üßπ</span>
                        Mantenimiento de Datos Locales
                    </h2>
                </div>
                
                <div class="seccion-contenido">
                    <div class="datos-locales-panel">
                        <!-- Estado de sincronizaci√≥n -->
                        <div class="sync-diferencias" id="syncDiferencias">
                            <h4>üìä Diferencias Supabase vs IndexedDB</h4>
                            <div class="tabla-container" id="tablaDiferencias">
                                <p class="cargando">Cargando comparaci√≥n...</p>
                            </div>
                        </div>
                        
                        <!-- Acciones de limpieza -->
                        <div class="limpieza-acciones">
                            <div class="limpieza-info">
                                <h4>üßπ Limpiar Datos Locales</h4>
                                <p>Elimina todos los datos de IndexedDB y vuelve a descargar desde Supabase.</p>
                                <p class="limpieza-advertencia">‚ö†Ô∏è Esta acci√≥n eliminar√° datos no sincronizados. Asegurate de sincronizar primero.</p>
                            </div>
                            
                            <div class="limpieza-botones">
                                <button class="btn-limpieza btn-limpieza-parcial" id="btnLimpiarColaSync">
                                    üßπ Limpiar Cola de Sincronizaci√≥n
                                </button>
                                <button class="btn-limpieza btn-limpieza-parcial" id="btnLimpiarDuplicados">
                                    üîÑ Limpiar Duplicados
                                </button>
                                <button class="btn-limpieza btn-limpieza-total" id="btnLimpiarTodo">
                                    üóëÔ∏è Limpiar Todo y Re-sincronizar
                                </button>
                            </div>
                            
                            <div class="limpieza-estado" id="limpiezaEstado"></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- ============================================
                 SECCI√ìN 6: ENLACES EXTERNOS
            ============================================ -->
            <section class="mant-seccion" id="seccionEnlaces">
                <div class="seccion-header">
                    <h2 class="seccion-titulo">
                        <span class="seccion-icono">üîó</span>
                        Enlaces Externos
                    </h2>
                </div>
                
                <div class="seccion-contenido">
                    <div class="enlaces-grid">
                        <a href="https://supabase.com/dashboard/project/jnplnwpofxzfqchkvgpv" 
                           target="_blank" 
                           class="enlace-card enlace-supabase">
                            <span class="enlace-icono">‚ö°</span>
                            <span class="enlace-texto">Abrir proyecto en Supabase</span>
                            <span class="enlace-arrow">‚Üí</span>
                        </a>
                        
                        <a href="https://github.com" 
                           target="_blank" 
                           class="enlace-card enlace-github">
                            <span class="enlace-icono">üêô</span>
                            <span class="enlace-texto">Repositorio GitHub</span>
                            <span class="enlace-arrow">‚Üí</span>
                        </a>
                    </div>
                </div>
            </section>
            
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="footer-mant">
        <div class="contenedor">
            <p>üîß Panel de Mantenimiento ‚Ä¢ Solo acceso autorizado ‚Ä¢ AdminisGo v1.0.0</p>
        </div>
    </footer>

    <!-- Librer√≠as externas -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.min.js"></script>
    
    <!-- JavaScript del sistema -->
    <script src="js/config.js"></script>
    <script src="js/supabase.js"></script>
    <script src="js/indexeddb.js"></script>
    <script src="js/sync.js"></script>
    <script src="js/mantenimiento.js"></script>
</body>
</html>

